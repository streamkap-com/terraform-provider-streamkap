## Codebase Patterns
- The `docs/audits/` directory already exists with reference documentation files
- Go build command: `go build ./...` for typechecking
- Branch naming: PRD specifies `ralph/terraform-provider-audit` branch for audit work

---

## 2026-01-21 - US-001
- What was implemented:
  - Created `docs/audits/architecture-comparison-report.md` with proper structure
  - Added document header with title, date, auditor info
  - Added Table of Contents with 4 main sections
  - Added empty placeholder sections: Main Branch Architecture, Refactored Architecture, Comparison Matrix, Trade-offs
- Files changed:
  - Created: `docs/audits/architecture-comparison-report.md`
  - Created: `tasks/progress.txt`
- **Learnings for future iterations:**
  - The `docs/audits/` directory already existed with `backend-code-reference.md` and `entity-config-schema-audit.md`
  - These existing docs are useful references for understanding the backend and config schema
---

## 2026-01-21 - US-002
- What was implemented:
  - Documented main branch architecture pattern in `docs/audits/architecture-comparison-report.md`
  - Read 2 representative connectors via git: `postgresql.go` (589 LOC) and `snowflake.go` (503 LOC)
  - Documented manual schemas, inline CRUD, ~400-600 LOC per connector pattern
  - Documented type conversion methods: `model2ConfigMap` and `configMap2Model`
  - Added code examples and summary table
- Files changed:
  - Modified: `docs/audits/architecture-comparison-report.md`
- **Learnings for future iterations:**
  - Main branch connectors can be accessed via `git show main:path/to/file`
  - Each main branch connector is ~400-600 LOC with significant code duplication
  - Key components: Resource model struct, Schema definition, CRUD operations, Type conversion methods
  - Connectors use `helper.GetTfCfgString/Int64/Bool` for type conversion from API response
---

## 2026-01-21 - US-003
- What was implemented:
  - Documented refactored three-layer architecture in `docs/audits/architecture-comparison-report.md`
  - Verified 3 generated files have `// Code generated by tfgen. DO NOT EDIT.` markers
  - Counted 52 total generated schema files (20 sources, 23 destinations, 8 transforms, 1 doc.go)
  - Documented file counts per layer with LOC statistics
  - Created ASCII architecture diagram showing three layers
  - Documented: Generated Schemas layer, Thin Wrappers layer, Shared Base Resource layer
  - Calculated ~53% LOC reduction per connector vs main branch (~235 vs ~500 LOC)
- Files changed:
  - Modified: `docs/audits/architecture-comparison-report.md`
- **Learnings for future iterations:**
  - Three-layer architecture: Generated Schemas → Thin Wrappers → Shared Base Resource
  - `internal/generated/` contains 52 auto-generated files (DO NOT EDIT)
  - `internal/resource/source/*_generated.go` and `internal/resource/destination/*_generated.go` are thin wrappers (~55 LOC each)
  - `internal/resource/connector/base.go` (701 LOC) contains all shared CRUD logic with reflection
  - Wrappers implement `ConnectorConfig` interface with: GetSchema, GetFieldMappings, GetConnectorType, GetConnectorCode, GetResourceName, NewModelInstance
  - Reflection-based marshaling in base.go: `modelToConfigMap()` and `configMapToModel()`
---

## 2026-01-21 - US-004
- What was implemented:
  - Verified wrapper files exist: 20 in `internal/resource/source/`, 22 in `internal/resource/destination/`
  - Verified ConnectorConfig interface implementation in 2 spot-checked files (postgresql_generated.go, snowflake_generated.go)
  - Both wrappers have compile-time interface check: `var _ connector.ConnectorConfig = (*Config)(nil)`
  - Verified `internal/resource/connector/base.go` contains shared CRUD logic (Create/Read/Update/Delete/ImportState)
  - Verified `modelToConfigMap()` and `configMapToModel()` use reflection for generic type conversion
  - Confirmed no business logic in generated files - only Model struct, Schema function, Field mappings
  - Typecheck passed: `go build ./...`
  - Added "Layer Separation Verification" section to audit report
- Files changed:
  - Modified: `docs/audits/architecture-comparison-report.md`
- **Learnings for future iterations:**
  - Wrapper files use compile-time interface compliance check pattern: `var _ Interface = (*Impl)(nil)`
  - base.go CRUD methods: Create (117-226), Read (229-313), Update (316-422), Delete (425-494)
  - Reflection helpers: extractTerraformValue(), setTerraformValue(), getStringField(), setStringField()
  - Generated files contain only: Model struct with tfsdk tags, Schema() function, FieldMappings map
---
